# TuyAPI [![XO code style](https://img.shields.io/badge/code_style-XO-5ed9c7.svg)](https://github.com/sindresorhus/xo)

A library for communicating with devices that use the [Tuya](http://tuya.com) cloud network. These devices are branded under many different names, but if port 6668 is open on your device chances are this library will work with it.
Currently only supports smart plugs, but it should be fairly trivial to add other types of devices.

## Installation

  `npm install @codetheweb/tuyapi`

## Basic Usage

    const TuyaDevice = require('tuyapi');

    var tuya = new TuyaDevice({
      type: 'outlet',
      ip: 'xxx.yyy.0.zzz',
      id: 'xxxxxxxxxxxxxxxxxxxx',
      uid: 'xxxxxxxxxxxxxxxxxxxx',
      key: 'xxxxxxxxxxxxxxxx'});

    tuya.getStatus(function(error, status) {
      if (error) { return console.log(error); }
      console.log('Status: ' + status);

      tuya.setStatus(!status, function(error, result) {
        if (error) { return console.log(error); }
        console.log('Result of setting status to ' + !status + ': ' + result);

        tuya.getStatus(function(error, status) {
          if (error) { return console.log(error); }
          console.log('New status: ' + status);
        });
      });
    });

  This should report the current status, set the device to the opposite of what it currently is, then report the changed status.

  The `id`, `uid`, and `key` must be found by sniffing the app that came with your device.

## Docs

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### TuyaDevice

Represents a Tuya device.

**Parameters**

-   `options` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** options for constructing a TuyaDevice
    -   `options.type` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** type of device (optional, default `'outlet'`)
    -   `options.ip` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** IP of device
    -   `options.port` **[number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** port of device (optional, default `6668`)
    -   `options.id` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** ID of device (called `devId` or `gwId`)
    -   `options.uid` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** UID of device
    -   `options.key` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** encryption key of device (called `localKey`)
    -   `options.version` **[number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** protocol version (optional, default `3.1`)

#### getStatus

Gets the device's current status.

**Parameters**

-   `callback` **function ([error](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error), result)** 

#### setStatus

Sets the device's status.

**Parameters**

-   `on` **[boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** `true` for on, `false` for off
-   `callback` **function ([error](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error), result)** returns `true` if the command succeeded

## Tests

  `npm test`
  (runs the [xo](https://www.npmjs.com/package/xo) style linter)

## TODO

1.  Either reuse a TCP connection between requests, keeping it alive by sending a packet every few seconds, or add a delay between subsequent commands.
2.  Figure out what the hex-encoded 'padding' is.
3.  Autodiscovery of devices?

## Contributors

-   [codetheweb](https://github.com/codetheweb)
-   [blackrozes](https://github.com/blackrozes)
